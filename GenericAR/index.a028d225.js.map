{"mappings":"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","sources":["src/loadJSON.ts","static/cargo/cargo.json","src/object/Sidepanel.ts","src/object/Target.ts","src/object/Vector3.ts","src/object/Model.ts","src/main.ts","src/interface/modelType.ts"],"sourcesContent":["import * as data from \"../static/cargo/cargo.json\";\nimport { instanceOfModelType, modelType } from \"./interface/modelType\";\n\nfunction fileExtension(filename) {\n    return filename.split('.').pop();\n}\n\nfunction validateModelFile(modelName: string) {\n    const autorizedExtensions = [\"glb\", \"gltf\"];\n    return autorizedExtensions.includes(fileExtension(modelName));\n}\n\nfunction validateEnvironment(environment: string) {\n    const autorizedExtensions = [\"hdr\"]\n    return !environment\n        || environment == \"neutral\"\n        || autorizedExtensions.includes(fileExtension(environment));\n}\n\nfunction validatePoster(poster: string[]) {\n    const autorizedExtensions = [\"webp\", \"png\", \"jpg\", \"jpeg\"]\n    return !poster || autorizedExtensions.includes(fileExtension(poster))\n}\n\nfunction validateData(data: any): data is modelType {\n    return validateModelFile(data.modelName)\n        && validateEnvironment(data.environment)\n        && validatePoster(data.posters)\n}\n\nexport default function loadJSON(): modelType {\n    if (instanceOfModelType(data) && validateData(data))\n        return data;\n    return null;\n}","{\n    \"modelName\": \"cargo/ressources/cargo ship.glb\",\n    \"environment\": \"cargo/ressources/aircraft_workshop_01_1k.hdr\",\n    \"skybox\": \"true\",\n    \"poster\": \"cargo/ressources/poster.webp\",\n    \"targets\": [\n        {\n            \"label\": \"Hélice\",\n            \"type\": \"content\",\n            \"position\": {\n                \"x\": -0.42,\n                \"y\": -0.10,\n                \"z\": 0.46\n            },\n            \"normal\": {\n                \"x\": 0,\n                \"y\": 0,\n                \"z\": 1\n            },\n            \"content\": \"Avec cette hélice, le bateau peut avancer.\"\n        },\n        {\n            \"label\": \"Conteneurs\",\n            \"type\": \"content\",\n            \"position\": {\n                \"x\": 0,\n                \"y\": 0.11,\n                \"z\": 0.45\n            },\n            \"content\": \"Les conteneurs permettent de transporter de la marchandise. \\n Ils peuvent contenir plusieurs tonnes de marchandise. \\n C'est le moyen le plus répandu pour transporter de grosses quantités sur de longues distances.\"\n        },\n        {\n            \"type\": \"content\",\n            \"position\": {\n                \"x\": 0.1,\n                \"y\": -0.07,\n                \"z\": 0.48\n            },\n            \"normal\": {\n                \"x\": 0,\n                \"y\": 0,\n                \"z\": 1\n            },\n            \"content\": \"<div>La coque permet au bateau de ne pas couler</div>\"\n        }\n    ]\n}","export default class Sidepanel {\n    content: string;\n    slot: number;\n\n    constructor(content, slot) {\n        this.content = content;\n        this.slot = slot;\n\n        this.addContentAsSidepanel();\n    }\n\n    addContentAsSidepanel() {\n        const sidepanel = document.createElement('div');\n        sidepanel.classList.add(\"sidepanel\");\n        sidepanel.id = `content-hotspot-${this.slot}`;\n\n        sidepanel.addEventListener(\"click\", (event) => Sidepanel.hideAllSidepanels());\n\n        const btn = document.createElement('a');\n        btn.classList.add(\"closebtn\");\n        btn.addEventListener(\"click\", (event) => Sidepanel.hideAllSidepanels());\n        btn.href = \"javascript: void(0)\"\n        btn.innerText = \"×\"\n        sidepanel?.appendChild(btn);\n\n        const p = document.createElement('p');\n        p.innerText = this.content;\n        sidepanel?.appendChild(p);\n\n        document.body.children[0]?.before(sidepanel);\n    }\n\n    static hideAllSidepanels() {\n        const sidepanels = document.querySelectorAll('.show');\n        Array.from(sidepanels).forEach(element => {\n            if (element) {\n                element.classList.remove(\"show\");\n            }\n        });\n    }\n\n    static showSidepanel(id) {\n        Sidepanel.hideAllSidepanels();\n        const panel = document.getElementById(`content-${id}`);\n        if (panel) {\n            panel.classList.add(\"show\");\n        }\n    }\n}","import Sidepanel from \"./Sidepanel\";\nimport Vector3 from \"./Vector3\";\n\nexport default class Target {\n    static counter = 0;\n    label?: string;\n    type?: string;\n    position: Vector3;\n    normal?: Vector3;\n    content?: Sidepanel;\n    slot: number;\n\n    constructor(position: Vector3, normal?: Vector3, label?: string, type?: string, content?: string) {\n        this.position = position;\n        this.normal = normal;\n        this.label = label;\n        this.type = type;\n        this.slot = Target.counter++;\n        this.content = new Sidepanel(content, this.slot);\n    }\n\n    toHTML(): string {\n        let html: string = `<button class=\"Hotspot\"\n        slot=\"hotspot-${this.slot}\"\n        data-position=\"${this.position.toHTML()}\" `\n        if (this.normal)\n            html += `data-normal=\"${this.normal.toHTML()}\"`\n        html += `data-visibility-attribute=\"visible\">\\n`\n        if (this.label)\n            html += `<div class=\"HotspotAnnotation\">${this.label}</div>\\n`\n        html += \"</button>\";\n\n        return html;\n    }\n\n\n    static addHotspotsEvents() {\n        // const app = document.getElementById(`app`);\n        // app.addEventListener('click', (target) => Sidepanel.hideAllSidepanels())\n\n        const hotspots = Array.from(document.getElementsByClassName('Hotspot'));\n\n        hotspots.forEach(hotspot => {\n            hotspot.addEventListener('click', function handleClick(event) {\n                const id = event.target.slot;\n                Sidepanel.showSidepanel(id);\n            });\n        });\n\n\n    }\n}","export default class Vector3 {\n    private x: number;\n    private y: number;\n    private z: number;\n\n    constructor(x, y, z) {\n        this.x = x;\n        this.y = y;\n        this.z = z;\n    }\n\n    static fromJSON({ x, y, z }: { x: number, y: number, z: number }): Vector3 {\n        return new Vector3(x, y, z);\n    }\n\n    getX(): number {\n        return this.x;\n    }\n\n    getY(): number {\n        return this.y;\n    }\n\n    getZ(): number {\n        return this.z;\n    }\n\n    setX(x): Vector3 {\n        this.x = x;\n        return this;\n    }\n\n    setY(y): Vector3 {\n        this.y = y;\n        return this;\n    }\n\n    setZ(z): Vector3 {\n        this.z = z;\n        return this;\n    }\n\n    toHTML() {\n        return `${this.x}m ${this.y}m ${this.z}m`\n    }\n}","import { modelType } from \"../interface/modelType\";\nimport Target from \"./Target\";\nimport Vector3 from \"./Vector3\";\n\nexport default class Model {\n    modelName: string;\n    annotations: Target[];\n    environment?: string;\n    skybox: boolean;\n    poster?: string;\n    arIcon?: string;\n    arPrompt?: string;\n    animation?: {\n        name: string;\n        speed?: number;\n    };\n\n    constructor(json: modelType) {\n        this.modelName = json.modelName;\n        this.annotations = [];\n        json.targets.forEach(target => {\n            this.annotations.push(new Target(\n                Vector3.fromJSON(target.position),\n                target.normal ? Vector3.fromJSON(target.normal) : null,\n                target.label,\n                target.type,\n                target.content\n            ))\n        });\n        this.poster = json.poster;\n        this.arIcon = json.arIcon;\n        this.arPrompt = json.arPrompt;\n        this.environment = json.environment;\n        this.skybox = json.skybox == \"true\";\n        this.animation = json.animation;\n    }\n\n    toHTML(): string {\n        const html = `<model-viewer \n            bounds=\"tight\" enable-pan shadow-intensity=\"1\"\n            ${this.addModel()}\n            ${this.addAR()}\n            ${this.addCameraControls()}\n            ${this.addPoster()}\n            ${this.addEnvironment()}\n            skybox-image=\"cargo/ressources/aircraft_workshop_01_1k.hdr\"\n        >\n        ${this.addAnnotations()}\n        ${this.addProgressBar()}\n        ${this.addARButton(\"View in your space\")}\n        ${this.addARPrompt()}\n        </model-viewer>`\n        return html;\n    }\n\n    private addModel() {\n        return `src=\"${this.modelName}\"`;\n    }\n\n    private addEnvironment() {\n        let html = \"\";\n        if (this.environment)\n            html += ` environment-image=\"${this.environment}\";`\n        if (this.environment != \"neutral\" && this.skybox)\n            html += `skybox-image=\"${this.environment}\"`;\n        return html;\n    }\n\n    private addAR() {\n        return `ar ar-modes=\"scene-viewer webxr quick-look\"`;\n    }\n\n    private addCameraControls() {\n        return \"camera-controls\";\n    }\n\n    private addPoster() {\n        if (this.poster && this.poster.length > 0)\n            return `poster=\"${this.poster}\"`\n        return \"\";\n    }\n\n    private addARButton(text: string) {\n        const src = this.arIcon ? this.arIcon : `${globalThis.defaultRessourcesPath}/ar_icon.png`;\n        return `<button slot=\"ar-button\" id=\"ar-button\" style=\"background-image: url(${src});\">\n        ${text}\n        </button>`\n    }\n\n    private addAnnotations() {\n        let html = \"\";\n        this.annotations.forEach(target => {\n            html += target.toHTML();\n        });\n        return html;\n    }\n\n    private addARPrompt() {\n        const src = this.arPrompt ? this.arPrompt : `${globalThis.defaultRessourcesPath}/ar_hand_prompt.png\"`;\n        return `<div id=\"ar-prompt\"><img src=\"${src}\"></div>`\n    }\n\n    private addProgressBar() {\n        return `<div class=\"progress-bar hide\" slot=\"progress-bar\"><div class=\"update-bar\"></div></div>`\n    }\n\n}","import loadJSON from \"./loadJSON\";\nimport Model from \"./object/Model\";\nimport Sidepanel from \"./object/Sidepanel\";\nimport Target from \"./object/Target\";\n\n\nfunction getId() {\n    const queryString = window.location.search;\n    const urlParams = new URLSearchParams(queryString);\n    return urlParams.get('id')\n}\n\nfunction hasId() {\n    const urlParams = new URLSearchParams(window.location.search);\n    return urlParams.has('id')\n}\n\nfunction defaultBehavior() {\n    const json = loadJSON();\n    const model = new Model(json);\n    document.getElementById(\"app\").innerHTML = model.toHTML();\n    Target.addHotspotsEvents();\n}\n\n\nfunction main() {\n    globalThis.defaultRessourcesPath = \"default/ressources/\"\n    if (hasId())\n        console.log(getId());\n    else\n        defaultBehavior();\n}\n\nfunction closeNav() {\n    Sidepanel.hideAllSidepanels();\n}\n\n\nmain();","export interface modelType {\n    modelName: string;\n    environment?: string;\n    skybox?: string;\n    poster?: string;\n    arIcon?: string;\n    arPrompt?: string;\n    targets?: {\n        label?: string;\n        type?: string,\n        position:\n        {\n            x: number;\n            y: number;\n            z: number;\n        };\n        normal?:\n        {\n            x: number;\n            y: number;\n            z: number;\n        };\n        content?: string;\n    }[];\n    animation?: {\n        name: string;\n        speed?: number;\n    };\n}\n\nexport function instanceOfModelType(object: any): object is modelType {\n    let isModelType = 'modelName' in object;\n    if (isModelType && 'targets' in object) {\n        let i = 0;\n        while (isModelType && i < object.targets.length) {\n            isModelType = isModelType\n                && 'position' in object.targets[i]\n                && 'x' in object.targets[i].position\n                && 'y' in object.targets[i].position\n                && 'z' in object.targets[i].position\n            i++;\n        }\n    }\n    return isModelType;\n}"],"names":["$feab9e82514c7af7$var$fileExtension","filename","split","pop","$feab9e82514c7af7$var$validateData","data1","modelName","includes","environment","poster","posters","$0c6215660d0b1b20$exports","JSON","parse","$ea7b03aa5cf2b5ff$export$2e2bcd8739ae039","constructor","content","slot","this","addContentAsSidepanel","sidepanel","document","createElement","classList","add","id","addEventListener","event","hideAllSidepanels","btn","href","innerText","appendChild","p","body","children","before","static","sidepanels","querySelectorAll","Array","from","forEach","element","remove","panel","getElementById","$348071020369dc9b$export$2e2bcd8739ae039","position","normal","label","type","counter","toHTML","html","getElementsByClassName","hotspot","target","showSidepanel","$5e36d7857d61b1a0$export$2e2bcd8739ae039","x","y","z","getX","getY","getZ","setX","setY","setZ","$8429b739cf1b7b30$export$2e2bcd8739ae039","json","annotations","targets","push","fromJSON","arIcon","arPrompt","skybox","animation","addModel","addAR","addCameraControls","addPoster","addEnvironment","addAnnotations","addProgressBar","addARButton","addARPrompt","length","text","globalThis","defaultRessourcesPath","$ad2bcec7a0192558$var$defaultBehavior","object","isModelType","i","model","innerHTML","addHotspotsEvents","URLSearchParams","window","location","search","has","console","log","queryString","get","$ad2bcec7a0192558$var$getId"],"version":3,"file":"index.a028d225.js.map"}